<html>
    <head>

    </head>
    <body>
        <script type="module">
            import {drawBoard, setBoard} from './board.js'
            import {allTetroes} from './tetromino.js'
            drawBoard()
            const board = setBoard()
            const tetroes = allTetroes()
            const tetro = tetroes[2]
            const animation = () => {
                if (board.isAvailable(tetro.get())) {
                    if (!board.isFirstRow()) board.removeTetro(tetro.get())
                    board.addTetro(tetro.get())
                    board.down(tetro.get())
                    setTimeout(() => window.requestAnimationFrame(animation), 1200)
                } else {
                    if (board.isFirstRow()) {
                        window.cancelAnimationFrame(animation)
                        console.log(board.state)
                        console.log("STOPPED")
                    } else {
                        board.start()
                        tetro.turn()
                        window.requestAnimationFrame(animation)
                    }   
                }
            }
            window.requestAnimationFrame(animation)
            document.body.addEventListener('keydown', event => {
                if (event.code === 'ArrowLeft') {
                    if (board.currentCol > 0) board.currentCol -= 1
                }
                if (event.code === 'ArrowRight') {
                    if (board.currentCol + tetro.get()[0].length < board.state.length) board.currentCol += 1
                }
            })
        </script>
    </body>
</html>