<html>
    <head>

    </head>
    <body>
        <script type="module">
            // FIX IT ALL
            import {drawBoard, setBoard} from './board.js'
            import {allTetroes} from './tetromino.js'
            import {setController} from './controller.js'
            drawBoard()
            const board = setBoard()
            const tetroes = allTetroes()
            let tetr = 3
            const tetro = tetroes[tetr]
            tetro.turn()
            const animation = () => {
                if (board.checkDownSpace(tetro.get()) && board.down()) {
                    console.log(board.currentRow + " " + board.currentCol)
                    if (!board.isFirstRow()) board.removeTetro(tetro.get())
                    board.addTetro(tetro.get(), (r) => r - 1, (c) => c)
                    setTimeout(() => window.requestAnimationFrame(animation), 500)
                } else {
                    if (board.isFirstRow()) {
                        window.cancelAnimationFrame(animation)
                        console.log(board.state)
                        console.log("STOPPED")
                    } else {
                        board.start()
                        window.requestAnimationFrame(animation)
                    }   
                }
            }
            window.requestAnimationFrame(animation)
            setController(board, tetro)
        </script>
    </body>
</html>