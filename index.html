<html>
    <head>

    </head>
    <body>
        <script type="module">
            // FIX IT ALL
            import {drawBoard, setBoard} from './board.js'
            import {allTetroes} from './tetromino.js'
            drawBoard()
            const board = setBoard()
            const tetroes = allTetroes()
            let tetr = 0
            const tetro = tetroes[tetr]
            tetro.turn()
            const animation = () => {
                if (board.checkDownSpace(tetro.get()) && board.down()) {
                    if (!board.isFirstRow()) board.removeTetro(tetro.get())
                    board.addTetro(tetro.get())
                    setTimeout(() => window.requestAnimationFrame(animation), 20)
                } else {
                    if (board.isFirstRow()) {
                        window.cancelAnimationFrame(animation)
                        console.log(board.state)
                        console.log("STOPPED")
                    } else {
                        board.start()
                        if (tetr === tetroes.length - 1) tetr = 0
                        else tetr += 1
                        board.currentCol += 1
                        window.requestAnimationFrame(animation)
                    }   
                }
            }
            window.requestAnimationFrame(animation)
            document.body.addEventListener('keydown', event => {
                if (event.code === 'ArrowLeft') {
                    if (board.currentCol > 0) board.currentCol -= 1
                }
                if (event.code === 'ArrowRight') {
                    if (board.currentCol + tetroes[tetr].get()[0].length < board.state.length) board.currentCol += 1
                }
            })
        </script>
    </body>
</html>